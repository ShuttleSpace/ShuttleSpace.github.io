import{_ as a,c as i,a2 as e,o as s}from"./chunks/framework.CQcFAaaG.js";const k=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"manual/builtin_variables.md","filePath":"manual/builtin_variables.md"}'),r={name:"manual/builtin_variables.md"};function n(o,t,h,l,d,p){return s(),i("div",null,t[0]||(t[0]=[e(`<p>Xmake provides the syntax of <code>$(varname)</code> to support the acquisition of built-in variables, for example:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">add_cxflags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-I$(buildir)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>It will convert the built-in <code>buildir</code> variable to the actual build output directory when compiling: <code>-I./build</code></p><p>General built-in variables can be used to quickly get and splicing variable strings when passing arguments, for example:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    -- Add source files in the project source directory</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    add_files</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(projectdir)/src/*.c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    -- Add a header file search path under the build directory</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    add_includedirs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(buildir)/inc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>It can also be used in the module interface of a custom script, for example:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    on_run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (target)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        -- Copy the header file in the current script directory to the output directory</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        os.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(scriptdir)/xxx.h&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(buildir)/inc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>All built-in variables can also be retrieved via the <a href="#val">val</a> interface.</p><p>This way of using built-in variables makes the description writing more concise and easy to read. Here are some of the variables built into xmake that can be obtained directly:</p><table tabindex="0"><thead><tr><th>Interface</th><th>Description</th><th>Supported Versions</th></tr></thead><tbody><tr><td><a href="#varos">$(os)</a></td><td>Get the operating system of the current build platform</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varhost">$(host)</a></td><td>Get native operating system</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#vartmpdir">$(tmpdir)</a></td><td>Get Temporary Directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varcurdir">$(curdir)</a></td><td>Get current directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varbuildir">$(buildir)</a></td><td>Get the build output directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varscriptdir">$(scriptdir)</a></td><td>Get Project Description Script Directory</td><td>&gt;= 2.1.1</td></tr><tr><td><a href="#varglobaldir">$(globaldir)</a></td><td>Get Global Configuration Directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varconfigdir">$(configdir)</a></td><td>Get Local Project Configuration Directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varprogramdir">$(programdir)</a></td><td>xmake installation script directory</td><td>&gt;= 2.1.5</td></tr><tr><td><a href="#varprojectdir">$(projectdir)</a></td><td>Get the project root directory</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varshell">$(shell)</a></td><td>Execute external shell command</td><td>&gt;= 2.0.1</td></tr><tr><td><a href="#varenv">$(env)</a></td><td>Get external environment variables</td><td>&gt;= 2.1.5</td></tr><tr><td><a href="#varreg">$(reg)</a></td><td>Get the value of the windows registry configuration item</td><td>&gt;= 2.1.5</td></tr></tbody></table><p>Of course, this variable mode can also be extended. By default, the <code>xmake f --var=val</code> command can be used to directly obtain the parameters. For example:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    add_defines</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-DTEST=$(var)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p class="tip"> All the parameter values ​​of the \`xmake f --xxx=...\` configuration can be obtained through built-in variables, for example: \`xmake f --arch=x86\` corresponds to \`$(arch)\`, others have \` $(plat)\`, \`$(mode)\` and so on. What are the specific parameters, you can check it out by \`xmake f -h\`. </p><p>Since the support is directly obtained from the configuration options, it is of course convenient to extend the custom options to get the custom variables. For details on how to customize the options, see: <a href="#option">option</a></p><h3 id="var-os" tabindex="-1">var.$(os) <a class="header-anchor" href="#var-os" aria-label="Permalink to &quot;var.$(os)&quot;">​</a></h3><h4 id="get-the-operating-system-of-the-current-build-platform" tabindex="-1">Get the operating system of the current build platform <a class="header-anchor" href="#get-the-operating-system-of-the-current-build-platform" aria-label="Permalink to &quot;Get the operating system of the current build platform&quot;">​</a></h4><p>If iphoneos is currently compiled, then this value is: <code>ios</code>, and so on.</p><h3 id="var-host" tabindex="-1">var.$(host) <a class="header-anchor" href="#var-host" aria-label="Permalink to &quot;var.$(host)&quot;">​</a></h3><h4 id="get-the-native-operating-system" tabindex="-1">Get the native operating system <a class="header-anchor" href="#get-the-native-operating-system" aria-label="Permalink to &quot;Get the native operating system&quot;">​</a></h4><p>Refers to the host system of the current native environment, if you compile on macOS, then the system is: <code>macosx</code></p><h3 id="var-tmpdir" tabindex="-1">var.$(tmpdir) <a class="header-anchor" href="#var-tmpdir" aria-label="Permalink to &quot;var.$(tmpdir)&quot;">​</a></h3><h4 id="getting-a-temporary-directory" tabindex="-1">Getting a temporary directory <a class="header-anchor" href="#getting-a-temporary-directory" aria-label="Permalink to &quot;Getting a temporary directory&quot;">​</a></h4><p>Generally used to temporarily store some non-permanent files.</p><h3 id="var-curdir" tabindex="-1">var.$(curdir) <a class="header-anchor" href="#var-curdir" aria-label="Permalink to &quot;var.$(curdir)&quot;">​</a></h3><h4 id="get-the-current-directory" tabindex="-1">Get the current directory <a class="header-anchor" href="#get-the-current-directory" aria-label="Permalink to &quot;Get the current directory&quot;">​</a></h4><p>The default is the project root directory when the <code>xmake</code> command is executed. Of course, if the directory is changed by <a href="#os-cd">os.cd</a>, this value will also change.</p><h3 id="var-buildir" tabindex="-1">var.$(buildir) <a class="header-anchor" href="#var-buildir" aria-label="Permalink to &quot;var.$(buildir)&quot;">​</a></h3><h4 id="get-the-current-build-output-directory" tabindex="-1">Get the current build output directory <a class="header-anchor" href="#get-the-current-build-output-directory" aria-label="Permalink to &quot;Get the current build output directory&quot;">​</a></h4><p>The default is usually the <code>./build</code> directory in the current project root directory. You can also modify the default output directory by executing the <code>xmake f -o /tmp/build</code> command.</p><h3 id="var-scriptdir" tabindex="-1">var.$(scriptdir) <a class="header-anchor" href="#var-scriptdir" aria-label="Permalink to &quot;var.$(scriptdir)&quot;">​</a></h3><h4 id="get-the-directory-of-the-current-project-description-script" tabindex="-1">Get the directory of the current project description script <a class="header-anchor" href="#get-the-directory-of-the-current-project-description-script" aria-label="Permalink to &quot;Get the directory of the current project description script&quot;">​</a></h4><p>That is, the directory path corresponding to <code>xmake.lua</code>.</p><h3 id="var-globaldir" tabindex="-1">var.$(globaldir) <a class="header-anchor" href="#var-globaldir" aria-label="Permalink to &quot;var.$(globaldir)&quot;">​</a></h3><h4 id="global-configuration-directory" tabindex="-1">Global Configuration Directory <a class="header-anchor" href="#global-configuration-directory" aria-label="Permalink to &quot;Global Configuration Directory&quot;">​</a></h4><p>Xmake&#39;s <code>xmake g|global</code> global configuration command, directory path for data storage, where you can place some of your own plugins and platform scripts.</p><p>The default is: <code>~/.config</code></p><h3 id="var-configdir" tabindex="-1">var.$(configdir) <a class="header-anchor" href="#var-configdir" aria-label="Permalink to &quot;var.$(configdir)&quot;">​</a></h3><h4 id="current-project-configuration-directory" tabindex="-1">Current project configuration directory <a class="header-anchor" href="#current-project-configuration-directory" aria-label="Permalink to &quot;Current project configuration directory&quot;">​</a></h4><p>The current project configuration storage directory, which is the storage directory of the <code>xmake f|config</code> configuration command, defaults to: <code>projectdir/.config</code></p><h3 id="var-programdir" tabindex="-1">var.$(programdir) <a class="header-anchor" href="#var-programdir" aria-label="Permalink to &quot;var.$(programdir)&quot;">​</a></h3><h4 id="xmake-installation-script-directory" tabindex="-1">xmake installation script directory <a class="header-anchor" href="#xmake-installation-script-directory" aria-label="Permalink to &quot;xmake installation script directory&quot;">​</a></h4><p>That is, the directory where the <code>XMAKE_PROGRAM_DIR</code> environment variable is located. We can also modify the xmake load script by setting this environment amount to implement version switching.</p><h3 id="var-projectdir" tabindex="-1">var.$(projectdir) <a class="header-anchor" href="#var-projectdir" aria-label="Permalink to &quot;var.$(projectdir)&quot;">​</a></h3><h4 id="project-root-directory" tabindex="-1">Project root directory <a class="header-anchor" href="#project-root-directory" aria-label="Permalink to &quot;Project root directory&quot;">​</a></h4><p>That is, the directory path specified in the <code>xmake -P xxx</code> command, the default is not specified is the current directory when the <code>xmake</code> command is executed, which is generally used to locate the project file.</p><h3 id="var-shell" tabindex="-1">var.$(shell) <a class="header-anchor" href="#var-shell" aria-label="Permalink to &quot;var.$(shell)&quot;">​</a></h3><h4 id="executing-external-shell-commands" tabindex="-1">Executing external shell commands <a class="header-anchor" href="#executing-external-shell-commands" aria-label="Permalink to &quot;Executing external shell commands&quot;">​</a></h4><p>In addition to the built-in variable handling, xmake also supports the native shell to handle some of the features that xmake does not support.</p><p>For example, there is a need now, I want to use the <code>pkg-config</code> to get the actual third-party link library name when compiling the Linux program, you can do this:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    set_kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;binary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> is_plat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;linux&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        add_ldflags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(shell pkg-config --libs sqlite3)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span></code></pre></div><p>Of course, xmake has its own automated third library detection mechanism, which generally does not need such trouble, and lua&#39;s own scripting is very good. .</p><p>But this example shows that xmake can be used with some third-party tools through the native shell. .</p><h3 id="var-env" tabindex="-1">var.$(env) <a class="header-anchor" href="#var-env" aria-label="Permalink to &quot;var.$(env)&quot;">​</a></h3><h4 id="get-external-environment-variables" tabindex="-1">Get external environment variables <a class="header-anchor" href="#get-external-environment-variables" aria-label="Permalink to &quot;Get external environment variables&quot;">​</a></h4><p>For example, you can get the path in the environment variable:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    add_includedirs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(env PROGRAMFILES)/OpenSSL/inc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="var-reg" tabindex="-1">var.$(reg) <a class="header-anchor" href="#var-reg" aria-label="Permalink to &quot;var.$(reg)&quot;">​</a></h3><h4 id="get-the-value-of-the-windows-registry-configuration-item" tabindex="-1">Get the value of the windows registry configuration item <a class="header-anchor" href="#get-the-value-of-the-windows-registry-configuration-item" aria-label="Permalink to &quot;Get the value of the windows registry configuration item&quot;">​</a></h4><p>Get the value of an item in the registry by <code>regpath; name</code>:</p><div class="language-lua vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$(reg HKEY_LOCAL_MACHINE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">SOFTWARE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Microsoft</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Windows NT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">CurrentVersion</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">XXXX;Name)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div>`,60)]))}const u=a(r,[["render",n]]);export{k as __pageData,u as default};
